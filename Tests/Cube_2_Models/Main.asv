close all;
clear;

% -------------------------- SET THE PHYSICS -------------------------

model = ModelType("Poromechanics_FEM");


% ----------------------- SIMULATION PARAMETERS ----------------------

fileName = "simParam.dat";
simParam = SimulationParameters(fileName,model);


% ------------------------------  MESH -------------------------------

% Create the Mesh object
topology = Mesh();

% Set the input file name
fileName = 'Mesh/Column_hexa.msh';

% Import the mesh data into the Mesh object
topology.importGMSHmesh(fileName);


%----------------------------- MATERIALS -----------------------------

% Set the input file name
%
fileName = 'materialsList.dat';
%
% Create an object of the Materials class and read the materials file
mat = Materials(model,fileName);


%------------------------------ ELEMENTS -----------------------------

% Create an object of the "Elements" class and process the element properties
gaussOrder = 2;
elems = Elements(topology,gaussOrder);

% Create an object of the "Faces" class and process the face properties
faces = Faces(model, topology);

% Wrap Mesh, Elements and Faces objects in a structure
grid = struct('topology',topology,'cells',elems,'faces',faces);


% Create and set the print utility
printUtils = OutState(model,topology,'outTime.dat','folderName','Output_ColumnTerzaghiMCC','flagMatFile',true);


%------------------------ BOUNDARY CONDITIONS ------------------------

% Write BC files programmatically with function utility 
F = -10; % vertical force
setTerzaghiBC('BCs',F,topology);
%

% Collect BC input file in a list
fileName = ["BCs/neuPorotop.dat","BCs/dirPoroLatY.dat","BCs/dirPoroLatX.dat","BCs/dirPoroBottom.dat"];

% Degree of freedom manager 
%fname = 'dof.dat';
dofmanager = DoFManager(topology,model);

% Create an object of the "Boundaries" class and read the boundary
% conditions
bound = Boundaries(fileName,model,grid);

% Create object handling construction of Jacobian and rhs of the model
domain = Discretizer('ModelType',model,...
                     'SimulationParameters',simParam,...
                     'DoFManager',dofmanager,...
                     'Boundaries',bound,...
                     'OutState',printUtils,...
                     'Materials',mat,...
                     'Grid',grid);


% Print model initial state
printState(domain);

% ---------------------------- SOLUTION -------------------------------

% Create the object handling the (nonlinear) solution of the problem
Solver = FCSolver(domain);
%
% Solve the problem
[simState] = Solver.NonLinearLoop();
%
% Finalize the print utility
domain.outstate.finalize()
%